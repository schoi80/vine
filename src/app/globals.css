@import 'tailwindcss';
@import 'leaflet/dist/leaflet.css';

@plugin 'daisyui' {
  themes: light, dark;
  logs: false;
}

@custom-variant dark (&:where([data-theme="dark"], [data-theme="dark"] *));

@theme {
  /* Font Families */
  --font-serif: var(--font-source-serif);
  --font-sans: var(--font-ibm-plex-sans);
  --font-mono: ui-monospace, 'Cascadia Code', 'Source Code Pro', monospace;
  --font-song-myung: var(--font-song-myung);
  --font-nanum-pen-script: var(--font-nanum-pen-script);
  --font-stylish: var(--font-stylish);
  --font-kaushan-script: var(--font-kaushan-script);

  /* Neutral Scale (12-step) */
  --color-neutral-50: #fafafa;
  --color-neutral-100: #f5f5f5;
  --color-neutral-200: #e5e5e5;
  --color-neutral-300: #d4d4d4;
  --color-neutral-400: #a3a3a3;
  --color-neutral-500: #737373;
  --color-neutral-600: #525252;
  --color-neutral-700: #404040;
  --color-neutral-800: #262626;
  --color-neutral-900: #171717;
  --color-neutral-950: #0a0a0a;

  /* Entity Accents (Light) */
  --color-accent-person: #3b82f6;
  --color-accent-place: #10b981;
  --color-accent-event: #8b5cf6;
  --color-accent-book: #64748b;

  /* Semantic Colors (Light Mode Defaults) */
  --color-bg-primary: #ffffff;
  --color-bg-secondary: #fafafa;
  --color-bg-tertiary: #f5f5f5;
  --color-bg-hover: #f5f5f5;

  --color-text-primary: #171717;
  --color-text-secondary: #525252;
  --color-text-tertiary: #a3a3a3;
  --color-text-inverse: #ffffff;

  --color-border: #e5e5e5;
  --color-border-hover: #d4d4d4;
  --color-border-focus: #3b82f6;

  --color-surface: #ffffff;
  --color-surface-elevated: #ffffff;

  /* Feedback Colors */
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-error: #ef4444;
  --color-info: #3b82f6;

  /* Spacing (8px grid) */
  --spacing-1: 0.25rem;
  --spacing-2: 0.5rem;
  --spacing-3: 0.75rem;
  --spacing-4: 1rem;
  --spacing-5: 1.25rem;
  --spacing-6: 1.5rem;
  --spacing-8: 2rem;
  --spacing-10: 2.5rem;
  --spacing-12: 3rem;
  --spacing-16: 4rem;

  /* Radii (Compact) */
  --radius-xs: 0.25rem;
  --radius-sm: 0.375rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  --radius-full: 9999px;

  /* Shadows (Subtle) */
  --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.08), 0 1px 2px -1px rgba(0, 0, 0, 0.08);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -2px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -4px rgba(0, 0, 0, 0.08);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.08), 0 8px 10px -6px rgba(0, 0, 0, 0.08);

  /* Z-Index Scale */
  --z-base: 0;
  --z-header: 50;
  --z-sticky: 60;
  --z-sidebar: 100;
  --z-overlay: 1900;
  --z-drawer: 2000;
  --z-modal: 2100;
  --z-tooltip: 2200;
  --z-toast: 2300;

  /* Motion */
  --duration-fast: 100ms;
  --duration-quick: 150ms;
  --duration-normal: 200ms;
  --duration-smooth: 300ms;
  --duration-slow: 500ms;

  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-soft: cubic-bezier(0.2, 0.8, 0.2, 1);
  --ease-snappy: cubic-bezier(0.2, 0, 0, 1);
}

@layer base {
  [data-theme='dark'] {
    --color-bg-primary: #171717;
    --color-bg-secondary: #262626;
    --color-bg-tertiary: #404040;
    --color-bg-hover: #262626;

    --color-text-primary: #fafafa;
    --color-text-secondary: #a3a3a3;
    --color-text-tertiary: #737373;
    --color-text-inverse: #171717;

    --color-accent-person: #60a5fa;
    --color-accent-place: #34d399;
    --color-accent-event: #a78bfa;
    --color-accent-book: #94a3b8;

    --color-border: #404040;
    --color-border-hover: #525252;
    --color-border-focus: #60a5fa;

    --color-surface: #171717;
    --color-surface-elevated: #262626;

    --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px -1px rgba(0, 0, 0, 0.4);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }

  * {
    border-color: var(--color-border);
  }

  body {
    background-color: var(--color-bg-primary);
    color: var(--color-text-primary);
    font-feature-settings:
      'rlig' 1,
      'calt' 1;
  }
}

@layer utilities {
  .z-header {
    z-index: var(--z-header);
  }

  .z-overlay {
    z-index: var(--z-overlay);
  }

  .z-drawer {
    z-index: var(--z-drawer);
  }

  .z-modal {
    z-index: var(--z-modal);
  }

  .font-song-myung {
    font-family: var(--font-song-myung);
  }

  /* Text shadow for contrast over semi-transparent backgrounds */
  .text-shadow-contrast {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
  }

  .text-shadow-contrast-lg {
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
  }
}

/* Typography Utilities */
.text-verse {
  font-family: var(--font-source-serif);
  font-size: 1.125rem;
  line-height: 1.75;
  letter-spacing: 0.01em;
  font-optical-sizing: auto;
  font-feature-settings: 'onum', 'pnum';
}

.text-verse-sm {
  font-family: var(--font-source-serif);
  font-size: 1.0625rem;
  line-height: 1.75;
  letter-spacing: 0.01em;
  font-optical-sizing: auto;
  font-feature-settings: 'onum', 'pnum';
}

.text-verse-lg {
  font-family: var(--font-source-serif);
  font-size: 1.25rem;
  line-height: 1.75;
  letter-spacing: 0.01em;
  font-optical-sizing: auto;
  font-feature-settings: 'onum', 'pnum';
}

.text-verse-kr {
  font-family: var(--font-gowun-batang);
  font-size: 1.125rem;
  font-weight: 800;
  line-height: 2;
  letter-spacing: -0.01em;
}

.text-verse-number {
  font-family: var(--font-ibm-plex-sans);
  font-size: 0.875rem;
  font-weight: 500;
  font-feature-settings: 'tnum', 'lnum';
  font-variant-numeric: tabular-nums lining-nums;
  color: var(--color-text-tertiary);
}

/* OpenType Features */
.font-feature-tnum {
  font-feature-settings: 'tnum';
  font-variant-numeric: tabular-nums;
}

.font-feature-smcp {
  font-feature-settings: 'smcp';
  font-variant-caps: small-caps;
}

.font-feature-onum {
  font-feature-settings: 'onum';
  font-variant-numeric: oldstyle-nums;
}

/* Background Utilities */
.bg-bg-primary {
  background-color: var(--color-bg-primary);
}

.bg-bg-secondary {
  background-color: var(--color-bg-secondary);
}

.bg-bg-tertiary {
  background-color: var(--color-bg-tertiary);
}

.bg-muted {
  background-color: var(--color-bg-tertiary);
}

.bg-hover {
  background-color: var(--color-bg-hover);
}

/* Text Color Utilities */
.text-text-primary {
  color: var(--color-text-primary);
}

.text-text-secondary {
  color: var(--color-text-secondary);
}

.text-text-tertiary {
  color: var(--color-text-tertiary);
}

/* Entity Accent Utilities */
.text-accent-person {
  color: var(--color-accent-person);
}

.text-accent-place {
  color: var(--color-accent-place);
}

.text-accent-event {
  color: var(--color-accent-event);
}

.text-accent-book {
  color: var(--color-accent-book);
}

.bg-accent-person {
  background-color: var(--color-accent-person);
}

.bg-accent-place {
  background-color: var(--color-accent-place);
}

.bg-accent-event {
  background-color: var(--color-accent-event);
}

.bg-accent-book {
  background-color: var(--color-accent-book);
}

.border-accent-person {
  border-color: var(--color-accent-person);
}

.border-accent-place {
  border-color: var(--color-accent-place);
}

.border-accent-event {
  border-color: var(--color-accent-event);
}

.border-accent-book {
  border-color: var(--color-accent-book);
}

/* Border Utilities */
.border-border {
  border-color: var(--color-border);
}

/* Paper Texture for Focus Mode */
.paper-texture {
  position: relative;
}

.paper-texture::before {
  content: '';
  position: absolute;
  inset: 0;
  opacity: 0.025;
  pointer-events: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 200px 200px;
  z-index: 1;
}

.paper-texture > * {
  position: relative;
  z-index: 2;
}

[data-theme='dark'] .paper-texture::before {
  opacity: 0.02;
  filter: invert(1);
}

/* Animation Utilities */
@keyframes verse-fade-up {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.verse-enter {
  animation: verse-fade-up var(--duration-normal) var(--ease-soft) forwards;
  opacity: 0;
}

@keyframes drawer-slide {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

.vine-drawer-enter {
  animation: drawer-slide var(--duration-smooth) var(--ease-soft);
}

/* Transition Utilities */
.transition-colors-quick {
  transition:
    background-color var(--duration-quick) var(--ease-out),
    border-color var(--duration-quick) var(--ease-out),
    color var(--duration-quick) var(--ease-out);
}

.transition-all-quick {
  transition: all var(--duration-quick) var(--ease-out);
}

/* React-d3-tree Custom Styles */
.rd3t-tree-container {
  width: 100%;
  height: 100%;
}

.rd3t-link,
.custom-link {
  stroke: none;
  fill: none;
}

[data-theme='dark'] .rd3t-link,
[data-theme='dark'] .custom-link {
  stroke: none;
}

.rd3t-node text {
  font-family: inherit;
}

/* Accessibility: Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Screen Reader Only */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Entity-colored Focus Rings (WCAG AA compliant) */
.focus-ring-person:focus-visible {
  outline: 2px solid var(--color-accent-person);
  outline-offset: 2px;
}

.focus-ring-place:focus-visible {
  outline: 2px solid var(--color-accent-place);
  outline-offset: 2px;
}

.focus-ring-event:focus-visible {
  outline: 2px solid var(--color-accent-event);
  outline-offset: 2px;
}

/* Skip Link for Keyboard Navigation */
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  z-index: var(--z-toast);
  padding: 0.5rem 1rem;
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  text-decoration: none;
  border: 2px solid var(--color-border-focus);
  border-radius: var(--radius-md);
  font-weight: 500;
}

.skip-link:focus {
  top: 0.5rem;
  left: 0.5rem;
}

/* High Contrast Focus Indicator */
@media (prefers-contrast: high) {
  *:focus-visible {
    outline-width: 3px;
    outline-color: currentColor;
  }
}

/* Summary Fade Gradient */
.summary-fade-gradient {
  background: linear-gradient(to bottom, transparent, #ffffff);
}

[data-theme='dark'] .summary-fade-gradient {
  background: linear-gradient(to bottom, transparent, #171717);
}
